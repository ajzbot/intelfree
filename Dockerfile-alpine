# Use Alpine Linux as the base image
FROM alpine:latest

# Update and install required packages
RUN apk update && \
    apk add --no-cache x11vnc xvfb xterm wget

# Set X11 environment variable
ENV DISPLAY=:0

# Install Xvfb
CMD ["Xvfb", ":0", "-screen", "0", "1024x768x24"]

# Expose VNC and noVNC ports
EXPOSE 5900
EXPOSE 6080

# Download and set up noVNC
RUN mkdir -p /usr/share/novnc && \
    wget -qO- https://github.com/novnc/noVNC/archive/refs/tags/v1.2.0.tar.gz | tar xz --strip 1 -C /usr/share/novnc

# Start x11vnc and noVNC
CMD ["sh", "-c", "x11vnc -display :0 -forever -passwd 1128 -shared & /usr/share/novnc/utils/launch.sh --vnc localhost:5900"]
